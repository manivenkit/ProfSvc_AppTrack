@page "/candidate"
@layout ProfSvcLayout
@inject IJSRuntime _runtime;

<Header></Header>

<div class="gridHolder">
	<div class="divGridToolBar">
		<div style="display: flex">
			<div style="flex: 1; text-align: left">
				<div style="display: flex; height: 25px; margin-top: 12px">
					<div style="display: flex; width: 350px;">
						<SfButton CssClass="buttonFirst" @onclick="FirstClick"></SfButton>
						<SfButton CssClass="buttonPrevious" @onclick="PreviousClick"></SfButton>
						<SfNumericTextBox @bind-Value="_currentPage" CssClass="pageNumeric" Decimals="0" EnablePersistence="false" Format="n0" Height="22px" ID="numericPage" Max="@PageCount"
										  Min="1" @onchange="PageNumberChanged" ShowSpinButton="false" TValue="int" Width="40px">
						</SfNumericTextBox>
						<div style="font-weight: bold; margin-left: 10px; margin-top: 3px; padding-right: 0; width: 10px;">of</div>
						<div style="font-weight: bold; margin-left: 10px; margin-top: 3px; padding-right: 10px; text-align: center; width: auto;">@PageCount</div>
						<SfButton CssClass="buttonNext" @onclick="NextClick"></SfButton>
						<SfButton CssClass="buttonLast" @onclick="LastClick"></SfButton>
					</div>
					<div style="font-weight: bold; margin-left: 120px; margin-top: 4px; padding-right: 0; width: 50px;">Show: </div>
					<SfDropDownList @bind-Value="@ItemCount" CssClass="dropItem" DataSource="_showRecords" ID="dropItemCount" TItem="IntValues" TValue="int" Width="100px">
						<DropDownListFieldSettings Text="Value" Value="Key" />
						<DropDownListEvents TItem="IntValues" TValue="int" ValueChange="ChangeItemCount" />
					</SfDropDownList>
				</div>
			</div>
			<div class="divRightControls" style="width: 520px">
				<SfButton Content="Refresh" CssClass="topToolButton" IconCss="refreshButton" @onclick="RefreshGrid"></SfButton>
				<SfButton CssClass="topToolButton" IconCss="newButton" @onclick="() => AddNewCandidate()">Add Candidate</SfButton>
				<AutoCompleteButton ID="autoCandidate" PlaceholderText="Select a Candidate" @ref="AutoCompleteControl" Ref="AutoCompleteControl"
									TypeInstance="@typeof(AdminCandidateDropDownAdaptor)" ValueChange="FilterGrid" />
			</div>
		</div>
	</div>
	<SfGrid AllowPaging="false" EnableHeaderFocus="true" EnableHover="true" Height="100%" @ref="Grid" TValue="Candidates" Width="99.75%">
		<GridSelectionSettings EnableToggle="false" Mode="SelectionMode.Row" Type="SelectionType.Single" />
		<SfDataManager Adaptor="Adaptors.CustomAdaptor" AdaptorInstance="@typeof(AdminCandidateAdaptor)" Key="ID" />
		<GridEvents DataBound="DataHandler" DetailDataBound="DetailDataBind" TValue="Candidates" />@*OnActionBegin="ActionBegin" OnActionComplete="ActionComplete" *@
		<GridColumns>
			<GridColumn Field="@nameof(Candidates.ID)" HeaderText="ID" IsPrimaryKey="true" Visible="false" Width="0"></GridColumn>
			<GridColumn HeaderText="Name" Width="20%">
				<Template Context="aCon">
					@{
						if (aCon is Candidates _con)
						{
							<span class="@(_con.Mpc ? "mpcicon" : "")">@_con.Name</span>
						}
					}
				</Template>
			</GridColumn>
			<GridColumn HeaderText="Phone" Width="14%">
				<Template Context="aCon">
					@{
						if (aCon is Candidates _con)
						{
							@(_con.Phone + " " + SkillObj)
						}
					}
				</Template>
			</GridColumn>
			<GridColumn HeaderText="Email" Width="19%">
				<Template Context="aCon">
					@{
						if (aCon is Candidates _con)
						{
							<a href="mailto:@(_con.Email)">@_con.Email</a>
						}
					}
				</Template>
			</GridColumn>
			<GridColumn HeaderText="Location" Width="19%">
				<Template Context="aCon">
					@{
						if (aCon is Candidates _con)
						{
							@_con.Location
						}
					}
				</Template>
			</GridColumn>
			<GridColumn Field="@nameof(Candidates.Updated)" HeaderText="Updated" Width="14%">
			</GridColumn>
			<GridColumn Field="@nameof(Candidates.Status)" HeaderText="Status" Width="14%"></GridColumn>
		</GridColumns>
		<GridTemplates Context="context">
			<DetailTemplate>
				@{
					//Candidates _candidates = context! as Candidates;
				}
				<SfTab CssClass="e-fill" Height="365" ID="tabCandidates" LoadOn="ContentLoad.Init" ShowCloseButton="false" Width="95%">
					<TabAnimationSettings>
						<TabAnimationPrevious Effect="AnimationEffect.None"></TabAnimationPrevious>
						<TabAnimationNext Effect="AnimationEffect.None"></TabAnimationNext>
					</TabAnimationSettings>
					<TabItems>
						<TabItem>
							<ChildContent>
								<TabHeader Text="Basic Info" />
							</ChildContent>
							<ContentTemplate>
								<BasicInfoPanel EditCandidate="EditCandidate" EditMPC="EditMPC" EditRating="EditRating" GetMPCDate="MPCDate" GetMPCNote="MPCNote" GetRatingDate="RatingDate"
												GetRatingNote="RatingNote" ModelObject="_candidateDetailsObject" SetCommunication="CandidateCommunication" SetEligibility="CandidateEligibility"
												SetExperience="CandidateExperience" SetJobOption="CandidateJobOptions" SetTaxTerm="CandidateTaxTerms" SetupAddress="Address" />
							</ContentTemplate>
						</TabItem>
						<TabItem>
							<ChildContent>
								<TabHeader Text="Skills" />
							</ChildContent>
							<ContentTemplate>
								<SkillPanel EditSkill="EditSkill" ModelObject="_candidateDetailsObject" ModelSkillObject="_candidateSkillsObject" @ref="SkillPanel" RowHeight="@RowHeight" DeleteSkill="DeleteSkill" />
							</ContentTemplate>
						</TabItem>
						<TabItem>
							<ChildContent>
								<TabHeader Text="Education" />
							</ChildContent>
							<ContentTemplate>
								<EducationPanel EditEducation="EditEducation" ModelObject="@_candidateEducationObject" RowHeight="@RowHeight" @ref="EducationPanel" DeleteEducation="DeleteEducation" />
							</ContentTemplate>
						</TabItem>
						<TabItem>
							<ChildContent>
								<TabHeader Text="Experience" />
							</ChildContent>
							<ContentTemplate>
								<ExperiencePanel EditExperience="EditExperience" ModelObject="@_candidateExperienceObject" RowHeight="@RowHeight" @ref="ExperiencePanel" DeleteExperience="DeleteExperience"  />
							</ContentTemplate>
						</TabItem>
						<TabItem>
							<ChildContent>
								<TabHeader Text="Notes" />
							</ChildContent>
							<ContentTemplate>
								<NotesPanel EditNotes="EditNotes" ModelObject="@_candidateNotesObject" RowHeight="@RowHeight" @ref="NotesPanel" DeleteNotes="DeleteNotes" />
							</ContentTemplate>
						</TabItem>
						<TabItem>
							<ChildContent>
								<TabHeader Text="Resume" />
							</ChildContent>
							<ContentTemplate>
								<div class="resumeContainerBox">
									<SfRichTextEditor Height="300px" Readonly="true" Value="@_candidateDetailsObject.TextResume">
										<RichTextEditorToolbarSettings Items="@_tools1" />
									</SfRichTextEditor>
								</div>
							</ContentTemplate>
						</TabItem>
						<TabItem>
							<ChildContent>
								<TabHeader Text="Downloads" />
							</ChildContent>
							<ContentTemplate>
								<div style="height: 100%">
								</div>
							</ContentTemplate>
						</TabItem>
						<TabItem>
							<ChildContent>
								<TabHeader Text="Candidate Activity" />
							</ChildContent>
							<ContentTemplate>
								<ActivityPanel EditActivity="EditActivity" ModelObject="@_candidateActivityObject" RowHeight="@RowHeight" />
							</ContentTemplate>
						</TabItem>
					</TabItems>
					<SfSpinner CssClass="spinnerHeight" @ref="@Spinner" Type="SpinnerType.Fabric" ZIndex="12000" />@**@
				</SfTab>
			</DetailTemplate>
		</GridTemplates>
	</SfGrid>

	<EditCandidateDialog CancelCandidate="CancelCandidate" Communication="Communication" Eligibility="Eligibility" Experience="Experience" HtmlAttributes="_htmlAttributes" HtmlAttributes1="_htmlAttributes1"
						 JobOptions="JobOptions" ModelObject="_candidateDetailsObjectClone" @ref="DialogEditCandidate" SaveCandidate="SaveCandidate" States="States" TaxTerms="TaxTerms" Tools="_tools1" />

	<ParseCandidateDialog @bind-VisibleCandidate="VisibleNewCandidate" @bind-VisibleCandidate:event="VisibleCandidateChanged" CancelCandidate="CancelCandidate" OnFileUpload="OnFileUpload" />

	<RatingCandidateDialog GridObject="_candidateRatingObject" HtmlAttributes1="_htmlAttributes1" ModelObject="RatingMPC" @ref="DialogRating" RowHeight="RowHeight" SaveRating="SaveRating" />

	<MPCCandidateDialog GridObject="_candidateMPCObject" HtmlAttributes1="_htmlAttributes1" ModelObject="RatingMPC" @ref="DialogMPC" RowHeight="RowHeight" SaveMPC="SaveMPC" />

	<EditSkillDialog ModelObject="SelectedSkill" SaveSkill="SaveSkill" @ref="DialogSkill" />
	
	<EditEducationDialog ModelObject="SelectedEducation" SaveEducation="SaveEducation" @ref="DialogEducation"/>

	<EditExperienceDialog ModelObject="SelectedExperience" SaveExperience="SaveExperience" @ref="DialogExperience"/>


	<div class="divGridFooter">
		<div style="display: flex">
			<div style="flex: 1; padding-left: 15px; text-align: left;">
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("A")'>A</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("B")'>B</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("C")'>C</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("D")'>D</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("E")'>E</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("F")'>F</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("G")'>G</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("H")'>H</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("I")'>I</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("J")'>J</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("K")'>K</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("L")'>L</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("M")'>M</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("N")'>N</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("O")'>O</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("P")'>P</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("Q")'>Q</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("R")'>R</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("S")'>S</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("T")'>T</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("U")'>U</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("V")'>V</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("W")'>W</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("X")'>X</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("Y")'>Y</SfButton>
				<SfButton CssClass="buttonAlphabet" @onclick='() => SetAlphabet("Z")'>Z</SfButton>
				<SfButton CssClass="buttonAlphabetClear" @onclick="AllAlphabet" style="width: 30px">All</SfButton>
				<SfButton CssClass="buttonAlphabetClear" @onclick="ClearFilter">Clear</SfButton>
			</div>
			<div style="width: 520px">
				Items
				<b>@StartRecord</b> to
				<b>@EndRecord</b> of
				<b>@Count</b> rows
			</div>
		</div>
	</div>
</div>